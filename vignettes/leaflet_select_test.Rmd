---
title: "Flex Dashboard displaying track of selected vessel"
output:
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
runtime: shiny
---

```{r setup, include=FALSE}
library(flexdashboard)
library(shiny)
library(leaflet)
library(highcharter)
library(vikingr)
library(tidyverse)

log <- read_ais_log(vikingr_example("vikingr-visby-2019-ais"))
decoded <- read_ais(log$message)

vessels <- log %>%
  left_join(decoded) %>%
  mutate(mmsi = as.character(mmsi)) %>%
  #filter(mmsi == "266445000")
  filter(mmsi %in% c("265628490", "266445000")) %>%
  mutate(lat = lat / 600000, lon = lon / 600000)

##Main dataframe I want to subset depending on inputselection    
    dataframe <- vessels 

ui <- bootstrapPage( 
      tags$style(type = "text/css", "html, body {width:100%;height:100%}"),
      absolutePanel(top = 10, right = 10,
      selectInput(inputId = "MMSI", 
                  label = "Select a mmsi", 
                  choices = c("265628490", "266445000"))),
      leafletOutput(outputId = "map", width = "100%", height = "700")
)

server <- function(input, output, session){

      eventReactive(input$mmsi,{
                    df <- subset(dataframe, mmsi == input$mmsi) ## "input$whaleID" should become the WhaleID that is selected from the inputselect.
                    df <- subset(df, select = c("lon", "lat")) 
      })                
      output$map <- renderLeaflet({
      leaflet() %>%
      addTiles() %>%
      addPolylines(df, lng = df$lon, lat = df$lat, col = "grey", opacity = 1) %>%
      addMarkers(df, lng = first(df$lon), lat = first(df$lat))
      })
    } 

shinyApp(ui = ui, server = server)
```
